#!/usr/bin/env bash
#
# Define the path to the Apache log file
#LOG_FILE="apache-access.log" # Make sure to have this file in the same directory

# Check if the log file exists
#if [[ ! -f "$LOG_FILE" ]]; then
#  echo "Log file not found: $LOG_FILE"
#  exit 1
#fi

# Use awk to extract IP addresses and HTTP status codes
#awk '{print $1, $9}' "$LOG_FILE"  # | grep -E '^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+ [0-9]{3}'
#awk '{count[$0]++} END {for (item in count) print count[item], item }' "$LOG_FILE"


# Define the path to the Apache log file
LOG_FILE="apache-access.log"  # Make sure this file is in the same directory

# Check if the log file exists
if [[ ! -f "$LOG_FILE" ]]; then
  echo "Log file not found: $LOG_FILE"
  exit 1
fi

# Use awk to process the log file
awk '{count[$1, $9]++} END {
  # Print the occurrences in the desired format
  for (key in count) {
    split(key, arr, SUBSEP)  # Split the key into IP and HTTP code
    printf "%d %s %s\n", count[key], arr[1], arr[2]
  }
}' "$LOG_FILE" | sort -nr
